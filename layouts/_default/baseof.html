<!DOCTYPE html>
<html lang="en">
<head>
    {{ partial "head.html" . }}
</head>
<body class="{{ with .Section }}section-{{ . }}{{ end }}">
    {{ partial "nav.html" . }}

    <main id="main-content" class="content-wrapper">
        {{ block "main" . }}{{ end }}
        {{ partial "lightbox.html" . }}
    </main>

    {{ partial "footer.html" . }}

    {{ $js := resources.Get "js/nav.js" | resources.Minify }}
    {{ $transition := resources.Get "js/transition.js" | resources.Minify }}
    <script src="{{ $js.RelPermalink }}"></script>
    <script src="{{ $transition.RelPermalink }}"></script>
    {{ $lightbox := resources.Get "js/lightbox.js" | resources.Minify }}
    <script src="{{ $lightbox.RelPermalink }}"></script>
    {{ partial "svg-sprites.html" . }}
    <script>
        window.hugo = {
            environment: {{ if hugo.IsServer }}'development'{{ else }}'production'{{ end }}
        };
    </script>
    {{ $analytics := resources.Get "js/analytics.js" | resources.Minify }}
    <script defer src="{{ $analytics.RelPermalink }}"></script>
    {{ $quickView := resources.Get "js/quick-view.js" | resources.Minify }}
    <script src="{{ $quickView.RelPermalink }}"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    {{ $search := resources.Get "js/search.js" | resources.Minify | resources.Fingerprint }}
    <script defer src="{{ $search.RelPermalink }}"></script>
    <script>
        window.onload = function() {
            const token = {{ .Site.Params.mixpanelToken | jsonify }};
            console.log('Mixpanel initialization status:', {
                mixpanelExists: typeof mixpanel !== 'undefined',
                mixpanelLoaded: window.mixpanelLoaded,
                config: window.mixpanel?.get_config?.(),
                environment: window.hugo.environment,
                hasToken: !!token
            });

            if (window.mixpanelLoaded) {
                mixpanel.init(token, {
                    debug: false,
                    track_pageview: false,
                    persistence: "localStorage"
                });
            } else {
                console.warn('Mixpanel not loaded');
            }
        };
    </script>
</body>
</html>

